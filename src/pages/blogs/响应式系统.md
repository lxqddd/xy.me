---
title: Vue 响应式系统
author: 向阳
pubDate: 2023-01-03
tag: 'VueSeries'
draft: true
layout: '../../layouts/PostLayout.astro'
---

## 响应式系统

我们都知道，响应式系统是 vue 的重要组成部分，在日常的开发过程中，我们一直受益于它，但是却不太清楚它具体是怎么运作的，因此今天写下这一篇文章，跟大家一起分享。

### 什么是响应式系统？

这个问题大部分同学应该都是知道的。响应式系统的数据模型是一个普通的 JavaScript 对象，而当你修改它们时，对应的视图会进行更新，这个数据变化到视图更新的过程，我们称之为响应式更新。

### 如何实现一个简单的响应式系统

我们来看一个案例，首先再页面中有一个 div，然后通过 `innerText` 将 `obj.name` 赋值给它，赋值完成后，我们再修改 `obj.name` 。这个时候我们发现页面中的内容还是 `obj.name` 的旧值，并没有更新。

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="text"></div>
    <script>
      const obj = {
        name: 'ys'
      }

      function updateTextContent(txt) {
        const text = document.getElementById('text')
        text.innerText = txt
      }

      updateTextContent(obj.name)

      obj.name = 'xy'
    </script>
  </body>
</html>
```

页面中展示的内容还是 `ys` 而不是 `xy`。

那样才能实现在修改 `obj.name` 的时候也去动态的更新视图呢？

解决了这个问题，也就实现了 vue 的响应式。我们先来实现一个最简单的版本。

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="text"></div>
    <script>
      const data = {
        name: 'ys'
      }

      const obj = new Proxy(data, {
        get(target, key) {
          return target[key]
        },

        set(target, key, val) {
          target[key] = val
          updateTextContent(val)
        }
      })

      function updateTextContent(txt) {
        const text = document.getElementById('text')
        text.innerText = txt
      }

      updateTextContent(obj.name)

      setTimeout(() => {
        obj.name = 'xy'
      }, 1000)
    </script>
  </body>
</html>
```

先说一下这段代码的运行效果。首先在页面中展示的是 `ys` 。一秒种之后，页面中的内容变成了 `xy` 。

这里我们用到了 `Proxy` ，它可以对对象 `data` 做代理，当代理之后的对象的属性变化时可以做一些拦截。在这块代码中，我们通过 `Proxy` 代理对象 `data`，拿到 `data` 的代理对象 `obj`。然后将 `obj.name` 赋值给 div 的 `innerText` ，在页面中显示。然后通过一个定时器，一秒之后修改 `obj.name`。在修改 `obj.name` 的时候会触发 obj 的 setter，在 setter 中我们调用了 `updateTextContent` 方法，因此，当 `obj.name` 更新的时候，视图也会被更新。

但是这样的方法并不通用，因为在日常的开发中，一个对象中不会只有一个属性，当不同的属性修改的时候我们要更新对应的视图。
